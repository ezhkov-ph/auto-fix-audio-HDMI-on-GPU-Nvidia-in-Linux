# auto-fix-audio-HDMI-on-GPU-Nvidia-in-Linux
Этот скрипт решает две распространенные и крайне раздражающие проблемы со звуком через HDMI на Linux-системах с проприетарными драйверами Nvidia.
This script solves two common and extremely irritating problems with sound through HDMI on Linux systems with Nvidia proprietary drivers.

### Проблема

1.  **Задержка перед началом воспроизведения:** Звук не появляется мгновенно. Первые 1-2 секунды аудио "съедаются", потому что аудиоустройство находится в режиме энергосбережения (`SUSPENDED`) и ему нужно время на "пробуждение".
2.  **Случайные щелчки и прерывания (статтеры):** Во время воспроизведения музыки или видео звук периодически заикается. Это происходит из-за того, что видеокарта для экономии энергии динамически меняет свои состояния производительности (P-States), что вызывает сбои в аудиопотоке.

### Решение

Этот скрипт автоматизирует исправление обеих проблем, внося несколько системных изменений:

-   **Отключает энергосбережение аудиокодека** на уровне ядра (`snd_hda_intel`).
-   **Настраивает WirePlumber/PipeWire** так, чтобы HDMI-выход всегда оставался в активном состоянии (`RUNNING`).
-   **Блокирует видеокарту в режиме максимальной производительности (P0)**, запрещая ей менять частоты во время низкой нагрузки.
-   **Создает службу `systemd`** для автоматического применения настроек производительности при каждой загрузке системы.

В результате вы получаете стабильный звук без задержек и прерываний.

### Установка (Быстрый способ)

Откройте терминал и выполните одну из следующих команд:

**С помощью `curl`:**
```bash
bash -c "$(curl -fsSL https://raw.githubusercontent.com/ВАШ_НИКНЕЙМ/linux-nvidia-hdmi-audio-fix/main/fix_hdmi_audio.sh)"
```

**С помощью `wget`:**
```bash
bash -c "$(wget -O - https://raw.githubusercontent.com/ВАШ_НИКНЕЙМ/linux-nvidia-hdmi-audio-fix/main/fix_hdmi_audio.sh)"
```
> **Важно:** Не забудьте заменить `ВАШ_НИКНЕЙМ` на ваш реальный никнейм на GitHub. Скрипт запросит пароль `sudo` для внесения изменений в систему.

После выполнения скрипта **перезагрузите компьютер**.

### Установка (Ручной способ)

Если вы предпочитаете сначала изучить код:

1.  Клонируйте репозиторий:
    ```bash
    git clone https://github.com/ВАШ_НИКНЕЙМ/linux-nvidia-hdmi-audio-fix.git
    ```
2.  Перейдите в папку проекта:
    ```bash
    cd linux-nvidia-hdmi-audio-fix
    ```
3.  Сделайте скрипт исполняемым:
    ```bash
    chmod +x fix_hdmi_audio.sh
    ```
4.  Запустите скрипт с правами администратора:
    ```bash
    sudo ./fix_hdmi_audio.sh
    ```
5.  **Перезагрузите компьютер.**

### Удаление и откат изменений

Если вы захотите отменить все изменения, выполненные скриптом, выполните следующие команды в терминале:

```bash
# Отключаем и удаляем службу systemd
sudo systemctl disable nvidia-performance-fix.service
sudo rm /etc/systemd/system/nvidia-performance-fix.service
sudo systemctl daemon-reload

# Удаляем скрипт производительности
sudo rm /usr/local/bin/nvidia-performance-fix.sh

# Удаляем правило для modprobe
sudo rm /etc/modprobe.d/nvidia-hdmi-audio-powersave-off.conf

# Удаляем пользовательскую конфигурацию WirePlumber
# (Внимание: эта команда удалит файл. Если вы вносили в него другие изменения, сделайте это вручную)
rm ~/.config/wireplumber/main.lua.d/50-alsa-config.lua

echo "Все изменения отменены. Перезагрузите компьютер."
```

### Лицензия

Этот проект распространяется под лицензией MIT. См. файл `LICENSE` для получения дополнительной информации.
